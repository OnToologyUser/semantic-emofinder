<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Semantic Emofinder</title>
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        
    </head>
    <body onload="search()">
        <header class="py-2 mb-2 border-bottom">
            <div class="d-flex flex-wrap container">
              <a class="mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
                <span class="fs-2">Semantic Emofinder</span>
              </a>
        
              <ul class="nav nav-pills">
                <li class="nav-item"><a href="search.html" class="nav-link" >Buscador</a></li>
                <li class="nav-item"><a href="bases.html" class="nav-link active" aria-current="page">Bases</a></li>
                <li class="nav-item"><a href="examples.html" class="nav-link">Ejemplos</a></li>
              </ul>
            
            </div>
        </header>
        
        <div class="container">
            <div class="row text-center">
                <h2>Bases de palabras</h2>
            </div>
            <form>
                <div class="row">
                    <legend>Filtros</legend>
                    <div class="col">
                        <legend>Atributos disponibles:</legend>
                        <p><strong>Dimensiones emocionales</strong></p>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Valence" id="base1">
                            <label class="form-check-label" for="base1">
                                Valencia
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Arousal" id="base2">
                            <label class="form-check-label" for="base2">
                                Activación
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Dominance" id="base3">
                            <label class="form-check-label" for="base3">
                                Dominancia
                            </label>
                        </div>
                        <p><strong>Categorías emocionales</strong></p>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Fear" id="base4">
                            <label class="form-check-label" for="base4">
                                Miedo
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Anger" id="base5">
                            <label class="form-check-label" for="base5">
                                Ira
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Happiness" id="base6">
                            <label class="form-check-label" for="base6">
                                Alegría
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Sadness" id="base7">
                            <label class="form-check-label" for="base7">
                                Tristeza
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="Disgust" id="base8">
                            <label class="form-check-label" for="base8">
                                Asco
                            </label>
                        </div>
                        
                    </div>
                    <div class="col">
                        <label for="palabras" class="col-form-label">Palabras disponibles:</label>
                        <button type="button" class="btn btn-secondary" data-bs-container="body" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-content="Escrbir las palabras separadas por comas sin espacios">
                            Info
                          </button>
                        <textarea id="palabras" class="form-control mb-2" rows="3"></textarea>
                        
                    </div>
                    

                </div>
                <div class="d-grid gap-2 col-6 mx-auto  border-bottom pb-2 mb-2">
                    <button type="button" class="btn btn-primary" onclick="detail()">Aplicar filtros</button>
                </div>
            </form>
            <div class="row">
                <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Nombre</th>
                        <th>Artículo</th>
                        <th>Enlace</th>
                        <th>Características disponibles</th>
                      </tr>
                    </thead>
                    <tbody id="data">
                    </tbody>
                  </table>
            </div>
        </div>
        <script>
            $(document).ready(function(){
            $('[data-bs-toggle="popover"]').popover();
            });

            function search() {
                document.getElementById("demo").innerHTML = "<p>cargando...</p>";
                
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onload = function() {
                    var myObj = JSON.parse(this.responseText);
                    
                    let text = ""
                    
                    for (x in myObj.results.bindings) {
                        text += "<tr>"+"<td>" + myObj.results.bindings[x].nombre.value + "</td>"+"<td>" + myObj.results.bindings[x].articulo.value + "</td>"+"<td> <a href='"+myObj.results.bindings[x].enlace.value+"''>" + myObj.results.bindings[x].enlace.value + "</a></td>"+"<td>"+myObj.results.bindings[x].anotaciones.value.replaceAll("https://www.usc.gal/pcc/app/emofinder/","")+"</td>"+"</tr>";
                    }
                       
                    document.getElementById("data").innerHTML = text;
                    
                }
                xmlhttp.open("GET", "/consulta_base", true);
                xmlhttp.send();
            }

            function detail(base) {
                
                var form = document.getElementsByClassName("form-check-input");
                var table = document.getElementById("data");
                var tr = table.getElementsByTagName("tr");
                var td, txtValue;

                //reinicia el display de la tabla
                for(var j = 0; j < tr.length; j++){
                    tr[j].style.display = "";
                }
                
                //oculta las filas que no cumplen con el filtro
                for(var i = 0; i < form.length; i++){
                    if(form[i].checked){
                        for(j = 0; j < tr.length; j++){
                            td = tr[j].getElementsByTagName("td")[3];
                            if (td) {
                                txtValue = td.textContent || td.innerText;
                                if (txtValue.indexOf(form[i].value) == -1) {
                                    tr[j].style.display = "none";
                                }
                            }
                        }
                    }
                }
            }

        </script>
    </body>
</html>